<?xml version="1.0" encoding="utf-8"?>
<odoo>
  <data>
        <record model="ir.ui.view" id="view_scm_entry_kanban">
          <field name="name">scm.entry.kanban</field>
          <field name="model">scm.entry</field>
          <field name="arch" type="xml">
              <kanban class="o_kanban_mobile">
                  <field name="name"/>
                  <field name="channel_ids"/>
                  <field name="campaign_type_id"/>
                  <field name="date_from"/>
                  <field name="date_to"/>
                  <field name="state"/>
                  <templates>
                      <t t-name="kanban-box">
                          <div t-attf-class="oe_kanban_card oe_kanban_global_click">
                              <div class="o_kanban_record_top mb16">
                                  <div class="o_kanban_record_headings mt4">
                                      SCM Name: <div class="o_kanban_record_title"><field name="name"/></div>
                                  </div>
                                  <div class="o_kanban_record_headings mt4">
                                      Related Project: <div class="o_kanban_record_title"><field name="project_id"/></div>
                                  </div>
                              </div>
                              <div class="o_kanban_record_top mb16">
                                  <div class="o_kanban_record_headings mt4">
                                      Start: <div class="o_kanban_record_title"><field name="date_from"/></div>
                                  </div>
                                  <div class="o_kanban_record_headings mt4">
                                      Stop: <div class="o_kanban_record_title"><field name="date_to"/></div>
                                  </div>
                              </div>
                              <div class="oe_kanban_bottom_right">
                                <field name="state" widget="label_selection" options="{'classes': {'draft': 'default', 'cancel': 'default'}}"/>
                              </div>
                          </div>
                      </t>
                  </templates>
              </kanban>
          </field>
      </record>

      <record id="view_scm_entry_tree" model="ir.ui.view">
          <field name="name">scm.entry.tree</field>
          <field name="model">scm.entry</field>
          <field name="priority">2</field>
          <field name="arch" type="xml">
              <tree string="SCM Entry">
                  <field name="name"/>
                  <field name="project_id"/>
                  <field name="project_scm_id"/>
                  <field name="user_id"/>
                  <field name="user_project_id"/>
                  <field name="channel_ids" widget="many2many_tags" optional="show"/>
                  <field name="campaign_type_id"/>
                  <field name="date_from"/>
                  <field name="date_to"/>
                  <field name="state" decoration-info="state == 'draft' or state == 'done'" decoration-success="state == 'cancel'" widget="badge" optional="show"/>
              </tree>
          </field>
      </record>

      <record id="view_scm_entry_form" model="ir.ui.view">
          <field name="name">scm.entry.form</field>
          <field name="model">scm.entry</field>
          <field name="arch" type="xml">
              <form string="SCM Entry" class="o_sale_order">
                <header>
                  <button name="action_scm_cancel" type="object" string="Cancel" attrs="{'invisible': ['|', ('state', 'not in', ['draft', 'lock']), ('id', '=', False)]}" data-hotkey="z" groups="ihhg_master.group_scm_manager" />

                  <button name="action_scm_draft" type="object" string="Set to Draft" states="cancel" groups="ihhg_master.group_scm_manager"/>

                  <button name="action_scm_lock" type="object" string="Lock" states="draft" groups="ihhg_master.group_scm_manager"
                  help="If the SCM is locked, you can not modify it anymore except unlocked by authorized personnel." />

                  <button name="action_scm_unlock" type="object" string="Unlock" states="lock" groups="ihhg_master.group_scm_manager"/>

                  <field name="state" widget="statusbar" statusbar_visible="draft,done,cancel"/>
                </header>
                <sheet>
                    <div class="oe_title">
                      <h1>
                          <field name="name" class="o_text_overflow" placeholder="SCM Name"/>
                      </h1>
                    </div>
                    <group>
                        <group>
                            <field name="project_id"/>
                            <field name="project_scm_id"/>
                            <field name="user_id"/>
                            <field name="user_project_id"/>
                        </group>
                        <group>
                            <field name="date_from"/>
                            <field name="date_to"/>
                            <field name="campaign_type_id"/>
                            <field name="category_id"/>
                        </group>
                      </group>
                    <notebook>
                      <page name="channel_subselection" string="Channel Subselection">
                          <field name="channel_ids" context="{'tree_view_ref': 'ihhg_master.view_channel_tree', 'scm_id': id}"/>
                      </page>
                      <!-- TODO use a smart button to open them in a new full view -->
                      <page name="package_selection" string="Package Selection">
                        <field name="package_line_ids" context="{'tree_view_ref': 'ihhg_master.view_package_line_tree_scm_entry', 'scm_id': id}"/>
                      </page>
                      <!-- TODO add a smart button to open them in a new full view also -->
                      <page name="item_planning" string="Item Planning">
                          <field name="item_line_ids" context="{'scm_id': id}">
                            <tree string="SCM Item Lines" editable="bottom" >
                                <control>
                                    <create name="add_item_control" string="Add an Item"/>
                                </control>
                                <field name="scm_id" invisible="1"/>
                                <field name="allowed_channel_ids" invisible="1" />
                                <field name="sequence" widget="handle"/>
                                <field name="item_id" domain="[('channel_id', 'in', allowed_channel_ids)]"/>
                                <field name="product_id" optional="hide"/>
                                <field name="package_id"/>
                                <field name="channel_id" invisible="1" />
                                <field name="item_date_from"/>
                                <field name="item_date_to"/>
                                <field name="dimension" optional="show"/>
                                <field name="shipping_allocating" optional="show"/>
                                <field name="quantity"/>
                                <field name="item_tags_ids" widget="many2many_tags" optional="show"/>
                            </tree>
                          </field>
                          <group name="note_group" col="6" class="mt-2 mt-md-0">
                            <group colspan="4">
                                <field name="note" nolabel="1" placeholder="Extra Item Notes..."/>
                            </group>
                            <group class="oe_subtotal_footer oe_right" colspan="2">
                                <field name="package_line_ids_total" colspan="2"/>
                                <field name="item_line_ids_total" colspan="2"/>
                            </group>
                            <group class="oe_subtotal_footer oe_right" colspan="2">
                                <field name="channel_ids_total" colspan="2"/>
                            </group>
                            <div class="oe_clear"/>
                        </group>
                      </page>
                    </notebook>
                </sheet>
                <div class="oe_chatter">
                    <field name="message_follower_ids"/>
                    <field name="activity_ids"/>
                    <field name="message_ids"/>
                </div>
              </form>
          </field>
      </record>

      <record id="view_scm_entry_gantt" model="ir.ui.view">
        <field name="name">scm.entry.gantt</field>
        <field name="model">scm.entry</field>
        <field name="arch" type="xml">
            <gantt
                    date_start="date_from"
                    date_stop="date_to"
                    default_group_by="name"
                    default_scale="week"
                    color="user_id"
                    scales="day,week,month,year"
                    precision="{'day': 'hour:full', 'week': 'day:full', 'month': 'day:full', 'year': 'day:full'}"
                    thumbnails="{'name': 'image_128'}">
                <field name="name"/>
                <field name="channel_ids"/>
                <field name="item_line_ids"/>
                <templates>
                    <div t-name="gantt-popover" class="container-fluid">
                        <div class="row no-gutters">
                            <div class="col">
                                <ul class="pl-1 mb-0">
                                    <li>
                                      <strong>SCM:</strong>
                                      <t t-esc="name"/>
                                    </li>
                                    <li>
                                      <strong>Campaign Start:</strong>
                                      <t t-esc="date_from.format('YYYY-MM-DD hh:mm:ss A')"/>
                                    </li>
                                    <li>
                                      <strong>Campaign Stop:</strong>
                                      <t t-esc="date_to.format('YYYY-MM-DD hh:mm:ss A')"/>
                                    </li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </templates>
            </gantt>
        </field>
      </record>

      <record id="view_scm_entry_filter" model="ir.ui.view">
          <field name="name">scm.entry.list.select</field>
          <field name="model">scm.entry</field>
          <field name="priority" eval="15"/>
          <field name="arch" type="xml">
              <search string="Search SCM Entry">
                  <field name="channel_ids"/>
                  <field name="campaign_type_id"/>
                  <field name="date_from"/>
                  <field name="date_to"/>
                  <group expand="0" string="Group By">
                      <filter string="Campaign Type" name="campaign_type_id" domain="[]" context="{'group_by': 'campaign_type_id'}"/>
                      <filter string="Project" name="project_id" domain="[]" context="{'group_by': 'project_id'}"/>
                      <filter string="Project Manager" name="user_project_id" domain="[]" context="{'group_by': 'user_project_id'}"/>
                      <filter string="Owner" name="user_id" domain="[]" context="{'group_by': 'user_id'}"/>
                  </group>
             </search>
          </field>
      </record>

      <record id="action_scm_entry_open" model="ir.actions.act_window">
          <field name="name">SCM Entry</field>
          <field name="type">ir.actions.act_window</field>
          <field name="res_model">scm.entry</field>
          <field name="view_mode">kanban,tree,form,gantt</field>
          <field name="search_view_id"/>
          <field name="context">{}</field>
          <field name="help" type="html">
              <p class="o_view_nocontent_smiling_face">
                  To create a new record
              </p><p>
                  <br/> Click on "Create"
              </p>
          </field>
      </record>
  </data>
</odoo>
